{% extends "cms/base.html" %}
{% block extra_css %}
<script src="https://code.jquery.com/jquery-1.12.4.min.js"
  integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<style>
  .button {
    display: flex;
    width: 48px;
    height: 32px;
    line-height: 32px;
    background-color: #3692ff;
    color: #fff;
    justify-content: center;
    align-items: center;
  }
</style>
<script>
  $(function () {
    $('.button').on('click', function (event) {
      event.preventDefault();
      var classVal = $(this).attr('class')
      if (classVal == 'button') {
        $(this).addClass('hit')
        $(this).empty()
        $(this).append('<input type="hidden" name="hit_records" value= "〇"/>')
        $(this).append('〇')
      }
      else if (classVal == 'button hit') {
        $(this).addClass('miss').removeClass('hit')
        $(this).empty()
        $(this).append('<input type="hidden" name="hit_records" value= "×"/>')
        $(this).append('×')
      }
      else if (classVal == 'button miss') {
        $(this).removeClass('miss')
        $(this).empty()
        $(this).append('<input type="hidden" name="hit_records" value= " "/>')
      }
    });
  });
</script>
{% endblock %}

{% load bootstrap4 %}

{% block title %}的中記録の編集{% endblock title %}

{% block content %}

<h4 class="mt-4 mb-5 border-bottom">的中記録の編集</h4>

{% if players %}
<form action="{% url 'cms:save_hit' competition_id=competition_id match_id=match_id %}" method="post">
  <table class="table">
    {% if existing_hits %}
    {% for current_shot in existing_hits %}
    <tr>
      <td>
        {{current_shot.shot_num}}本目
      </td>
      {% for current_player_hit in current_shot.hit %}
      <td align="center">
        <div class="button" data-text-default="Click" data-text-clicked="Done">
          <input type="hidden" name="hit_records" value={{ current_player_hit }}>
          {{ current_player_hit }}
        </div>
      </td>
      {% endfor %}
    </tr>
    {% endfor %}
    {% else %}
    {% for current_shot in shots %}
    <tr>
      <td>
        {{current_shot}}本目
      </td>
      {% for current_shot in shoot_order %}
      <td align="center">
        <div class="button" data-text-default="Click" data-text-clicked="Done">
          <input type="hidden" name="hit_records" value=" ">
        </div>
      </td>
      {% endfor %}
    </tr>
    {% endfor %}
    {% endif %}
    <tr>
      <td>選手ID</td>
      {% for player in players %}
      <td align="center">
        <input type="hidden" name="player_ids" value={{ player.id }} />
        {{player.id}}
      </td>
      {% endfor %}
    <tr>
      <td>選手名</td>
      {% for player in players %}
      <td align="center">
        {{player.name}}
      </td>
      {% endfor %}
    </tr>
    <tr>
      <td>立順</td>
      {% for current_shoot_order in shoot_order %}
      <td align="center">
        {{ current_shoot_order }}
        <input type="hidden" name="shoot_orders" value={{ current_shoot_order }} />
      </td>
      {% endfor %}
    </tr>
    <tr>
      <td>団体名</td>
      {% if players.0.team_name == players.1.team_name and players.1.team_name == players.2.team_name and players.0.team_name == players.2.team_name %}
      <td colspan="3" align="center">
        {{players.0.team_name}}
      </td>
      {% else %}
      <td colspan="3" align="center">
        団体名が一致していません
      </td>
      {% endif %}
      {% if players.3.team_name == players.4.team_name and players.4.team_name == players.5.team_name and players.3.team_name == players.5.team_name %}
      <td colspan="3" align="center">
        {{players.3.team_name}}
      </td>
      {% else %}
      <td colspan="3" align="center">
        団体名が一致していません
      </td>
      {% endif %}
    </tr>
    <tr>
      <td>射場</td>
      <td colspan="3" align="center">
        <input type="hidden" name="grounds" value="2" />
        <input type="hidden" name="grounds" value="2" />
        <input type="hidden" name="grounds" value="2" />
        第2射場
      </td>
      <td colspan="3" align="center">
        <input type="hidden" name="grounds" value="1" />
        <input type="hidden" name="grounds" value="1" />
        <input type="hidden" name="grounds" value="1" />
        第1射場
      </td>
    </tr>
  </table>
  <br />
  {% csrf_token %}
  <button type="submit" class="btn btn-primary">記録を保存する</button>
</form>
<br>

<form action="{% url 'cms:change_player' competition_id=competition_id match_id=match_id %}" method="post">
  {% for player in players %}
      <td align="center">
        <input type="hidden" name="player_ids" value={{ player.id }} />
      </td>
  {% endfor %}
  {% csrf_token %}
  <button type="submit" class="btn btn-primary">選手を変更する</button>
</form>

{% else %}
<form action="{% url 'cms:get_players' competition_id=competition_id match_id=match_id %}" method="POST">
  <table class="table">
    <tr>
      <td>選手ID</td>
      {% for current_shooting_order in shoot_order %}
      <td>
        <input class="form-control" type="text" value="" name="player_id">
      </td>
      {% endfor %}
    </tr>
    <tr>
      <td>立順</td>
      {% for current_shooting_order in shoot_order %}
      <td>
        {{ current_shooting_order }}
        <input type="hidden" name="range[]" value= />
      </td>
      {% endfor %}
    </tr>
    <tr>
      <td>射場</td>
      <td colspan="3">
        第2射場
      </td>
      <td colspan="3">
        第1射場
      </td>
    </tr>
  </table>
  {% csrf_token %}
  <button type="submit" class="btn btn-primary">的中記録開始</button>
</form>
{% endif %}
<br>

<a href="{% url 'cms:match_list' competition_id=competition_id %}" class="btn btn-secondary btn-sm">
  戻る
</a>
{% endblock content %}